실로봇 기반 상수 캘리브레이션 체크리스트 (Unitree Go2 PHM)
작성일: 2026-02-14

목적
- 현재 코드는 논리적으로 일관되게 동작하지만, 상수값은 "합리적 초기값(prior)"이 포함되어 있음.
- 논문(특히 PHM)에서 설득력을 높이려면, 아래 상수는 실로봇 로그로 추정/검증해야 함.

----------------------------------------------------------------------
0) 네가 이미 수집 가능한 채널(사용)
----------------------------------------------------------------------
- 모터 12축: q, dq, tau_est, temp(case/housing 계열)
- BMS/배터리: pack voltage, pack current, cell voltage(0..7), SOC
- IMU: quaternion, angular_velocity, accelerometer
- foot contact/force 계열
- 수신 주기: 500 Hz (권장 분석 주기: 50 Hz로 다운샘플)

주의
- 실로봇에서 직접 측정되는 온도는 "coil hotspot"이 아니라 case/housing 쪽.
- 따라서 coil 관련 상수는 완전 식별이 어렵고, 일부는 prior 고정 + 나머지 fit 방식이 현실적.

----------------------------------------------------------------------
1) 최우선(실데이터로 반드시 맞출 상수)
----------------------------------------------------------------------

[A] 열 모델 (2-node: coil <-> case <-> ambient)
코드 위치:
- unitree_go2_phm/source/unitree_go2_phm/unitree_go2_phm/tasks/manager_based/unitree_go2_phm/phm/constants.py
  C_THERMAL_COIL
  C_THERMAL_CASE
  K_COIL_TO_CASE
  K_CASE_COOLING
  K_CASE_WIND

왜 중요?
- RealObs는 case 온도로 판단/보상/종료를 걸기 때문에, case 동역학이 틀리면 논문 주장이 약해짐.

실측 추정 권장 순서:
1) C_THERMAL_COIL은 prior로 먼저 고정(데이터시트/기존값 유지).
2) case 로그를 타깃으로 C_THERMAL_CASE, K_COIL_TO_CASE, K_CASE_COOLING, K_CASE_WIND를 fit.
3) 필요 시 C_THERMAL_COIL도 미세조정.

식별 난점(중요):
- case만 측정하면 C_THERMAL_COIL과 K_COIL_TO_CASE는 서로 상쇄되어 비식별성 발생 가능.
- 해결: C_THERMAL_COIL 고정 + 나머지 식별이 안전.

필요 로그:
- motor temp(12), tau_est(12), dq(12), ambient(없으면 시작온도 근사), 속도 프로파일(걷기/회전/정지 포함)

합격 기준(권장):
- case temp MAE < 2.5 degC
- case temp 95% 오차 < 5 degC
- 과도구간(가열/냉각 시작 10~20 s)에서 추세 방향 불일치 없을 것


[B] 배터리 전압 모델
코드 위치:
- unitree_go2_phm/source/unitree_go2_phm/unitree_go2_phm/tasks/manager_based/unitree_go2_phm/phm/utils.py
  compute_battery_voltage()
  - internal_resistance (기본 0.15)
  - max_sag_ratio (기본 0.40)
  - OCV 맵 계수: 24.0 + 9.6 * SOC

왜 중요?
- brownout/budget 관측이 전압 모델에 직접 의존.
- 전압 sag 재현이 안 되면 governor/PHM 전략 평가가 왜곡됨.

실측 추정:
1) rest 구간에서 OCV-SOC 관계(선형/2차)를 fit.
2) 동적 구간에서 DeltaV/DeltaI로 internal_resistance 추정.
3) max_sag_ratio는 안전한 클리핑용이므로 과도폭주 방지 수준에서 튜닝.

합격 기준(권장):
- pack voltage MAE < 0.4 V
- 저전압 구간(컷오프 근처)에서 오차가 체계적으로 한쪽으로 치우치지 않을 것


[C] 실측 온도 임계치/전압 임계치 검증
코드 위치:
- RealObs 관측/보상/종료
  unitree_go2_phm/source/unitree_go2_phm/unitree_go2_phm/tasks/manager_based/unitree_go2_phm/unitree_go2_realobs_env_cfg.py
  - thermal_stress: warn_temp, crit_temp
  - thermal_safety reward limit_temp
  - thermal_failure threshold_temp
- brownout threshold
  unitree_go2_phm/source/unitree_go2_phm/unitree_go2_phm/tasks/manager_based/unitree_go2_phm/unitree_go2_phm_env_cfg.py
  - brownout_enter_v, brownout_recover_v

왜 중요?
- 논문에서 "운영 안전 경계"로 직접 인용되는 파라미터.

권장:
- 온도: 60~65 운영, 70 근처 경고, 72 이상 강정지(현재 가정) 실측으로 확인.
- 전압: pack/cell 저전압 경계(예: pack 24.5, cell 3.0 부근) 로그로 확인.

----------------------------------------------------------------------
2) 중간 우선순위(실측 기반 튜닝 권장)
----------------------------------------------------------------------

[D] 마찰/기계 손실 계수
코드 위치:
- constants.py
  B_VISCOUS, STICTION_NOMINAL, STICTION_WEAR_FACTOR, WEAR_FRICTION_GAIN

로그/시험:
- 저속 왕복(sine) + 정지 유지(hold) + 부하 변화
- tau_est vs dq로 정적/점성 성분 분리

목적:
- 발열/전력/포화 예측이 동시에 맞도록 조정


[E] 회생 효율 곡선
코드 위치:
- constants.py: REGEN_PEAK_EFFICIENCY, REGEN_OPTIMAL_SPEED, REGEN_WIDTH
- utils.py: compute_regenerative_efficiency()

주의:
- 현재 프로젝트는 "회생으로 SOC 증가를 직접 반영하지 않음" 설계.
- 이 파트는 전력 흐름 일관성 위주로 맞추고, 배터리 충전 이득 주장에는 보수적으로 접근.

----------------------------------------------------------------------
3) 낮은 우선순위(논문 하이퍼파라미터 성격, 즉시 실측 어려움)
----------------------------------------------------------------------

[F] 열화/수명 계수
- FATIGUE_EXPONENT
- FATIGUE_SCALE
- VIBRATION_FATIGUE_SCALE
- THERMAL_STRESS_SCALE

설명:
- 짧은 기간 실험으로 "진짜 수명"을 직접 식별하기 어려움.
- 따라서 이 값은 "상대 비교/민감도 분석용 파라미터"로 두고,
  절대 수명 예측이라고 과하게 주장하지 않는 게 안전.

----------------------------------------------------------------------
4) 실제 작업 순서(추천)
----------------------------------------------------------------------

Step 1) 열/전압 로그셋 고정
- 시나리오 3개: 저부하/중부하/고부하
- 각 10~20분 이상
- 500 Hz 수집, 분석은 50 Hz 다운샘플

Step 2) 열 모델 먼저 맞춤
- case 온도 RMSE/MAE 최소화로 2-node 계수 fit
- coil 관련은 prior 고정 후 최소 조정

Step 3) 배터리 모델 맞춤
- OCV-SOC -> internal_resistance -> sag clamp 순

Step 4) 임계치 검증
- 온도/전압 경계가 실제 경고/보호 동작과 맞는지 로그로 확인

Step 5) 마지막으로 마찰/열화 파라미터 미세 튜닝

----------------------------------------------------------------------
5) 논문에 쓰는 표현 가이드(중요)
----------------------------------------------------------------------

- 강하게 주장 가능:
  "관측 채널(케이스 온도/전압) 기반 안전 제어 및 성능-안전 트레이드오프"

- 보수적으로 써야 함:
  "절대 수명(RUL) 정확 추정"
  "coil hotspot 절대값 정확 추정"

- 권장 문구:
  "Case/housing temperature-calibrated thermal model with physically constrained latent coil state."

