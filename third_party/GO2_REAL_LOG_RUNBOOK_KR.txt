Go2 Real Log Runbook (논문용)
==============================

목적
----
실로봇 ON 이후, 아래 2개 로그를 같은 실험에서 확보:
1) raw LowState 로그 (원본, 500Hz 권장)
2) governor step 로그 (50Hz, steps.csv + summary.json)


중요: 현재 third_party/log_collector.py 기본 상태
-----------------------------------------------
현재 코드에는 아래 1초 게이트가 있어서 사실상 1Hz 저장입니다.

    if now - self.last_logged < 1.0:
        return

논문용/보정용으로는 너무 느립니다. 반드시 500Hz 근처로 바꾸세요.

권장 수정(최소):
1) __init__에 추가:
    self.log_period = 1.0 / 500.0
2) callback에서 교체:
    if now - self.last_logged < self.log_period:
        return
    self.last_logged = now
    t = now - self.start_time


실행 순서 (로봇 ON 후)
---------------------
아래를 터미널 3개로 나눠 실행하세요.

[터미널 1] raw logger (LowState CSV)
------------------------------------
# 1) ROS2 환경 로드 (본인 환경에 맞게)
source /opt/ros/humble/setup.bash
# 필요하면 추가:
# source ~/your_ws/install/setup.bash

# 2) 프로젝트 루트로 이동
cd /home/iamjaehka13/unitree_go2_phm

# 3) raw 로그 저장 시작
python3 third_party/log_collector.py

# 종료: Ctrl+C
# 출력 파일: go2_full_log.csv (실행한 현재 폴더 기준)


[터미널 2] SDK2 UDP bridge
--------------------------
cd /home/iamjaehka13/unitree_go2_phm

# (최초 1회) 빌드
cmake -S unitree_go2_phm/scripts/real/sdk2_bridge -B /tmp/go2_udp_bridge_build
cmake --build /tmp/go2_udp_bridge_build -j

# 실행 (네트워크 인터페이스명은 환경에 맞게 변경)
/tmp/go2_udp_bridge_build/go2_udp_bridge enp3s0 --auto-stand-up

# 옵션: estop bit 사용 시
# /tmp/go2_udp_bridge_build/go2_udp_bridge enp3s0 --auto-stand-up --estop-bit-mask 1


[터미널 3] 50Hz governor/step logger
------------------------------------
cd /home/iamjaehka13/unitree_go2_phm

python3 unitree_go2_phm/scripts/real/run_governor_live_template.py \
  --command_file unitree_go2_phm/scripts/rsl_rl/replay_commands/s1_thermal_cruise.yaml \
  --state_host 127.0.0.1 --state_port 17001 \
  --cmd_host 127.0.0.1 --cmd_port 17002 \
  --out_dir ./real_runs/$(date +%Y%m%d_%H%M%S)_run01

# 생성물:
# - ./real_runs/.../steps.csv
# - ./real_runs/.../summary.json


실험 1회 끝난 뒤 필수 확인
--------------------------
1) raw 로그 행 수 확인
    wc -l go2_full_log.csv

2) step 로그 행 수 확인
    wc -l ./real_runs/<run_dir>/steps.csv

3) summary 확인
    cat ./real_runs/<run_dir>/summary.json


오프라인 평가 (선택)
-------------------
run_governor_live_template.py 결과(steps.csv)는 이미 50Hz 분석용입니다.
추가로 오프라인 재평가가 필요하면:

python3 unitree_go2_phm/scripts/real/offline_governor_eval_from_log.py \
  --input_csv ./real_runs/<run_dir>/steps.csv \
  --output_json ./real_runs/<run_dir>/offline_eval.json \
  --governor


논문용 최소 수집 권장
--------------------
조건 3개 x 각 3회:
1) nominal (중간 SOC, 기본 replay)
2) thermal_stress (지속 고부하 명령)
3) low_soc (낮은 SOC 시작)

각 run 메타데이터 같이 기록:
- ambient 온도
- 시작 SOC
- 바닥 종류
- run ID


실패 시 빠른 점검
---------------
1) 터미널 2 bridge 미실행 -> 터미널 3 state_timeout 발생
2) 인터페이스명 오타(enp3s0 등) -> LowState 미수신
3) logger 1Hz 미수정 -> raw log 품질 부족
4) 셀전압 단위 확인 필요(mV면 V로 변환해서 저장)

