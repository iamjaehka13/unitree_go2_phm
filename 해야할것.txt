# 해야할것.txt

작성일: 2026-02-22
목적: "해보면서 맞추되", 논문 방어 가능한 방식으로 실험을 고정/자동화한다.

========================================================================
0. 운영 원칙 (항상 고정)
========================================================================
- [ ] Dev(탐색)와 Paper(확정) 실험을 분리한다.
- [ ] 의사결정 기준은 train 로그가 아니라 eval(12모터 고정 스윕)으로 둔다.
- [ ] max_iterations는 넉넉히 두고, 종료는 early-stop 규칙으로 결정한다.
- [ ] 최종 비교는 last가 아니라 best checkpoint 기준으로 한다.

========================================================================
1. 메인 프로토콜 (변경 금지)
========================================================================
- [ ] Task(main): `Unitree-Go2-RealObs-v1`
- [ ] Train fault mode: `single_motor_random`
- [ ] Eval fault mode: `single_motor_fixed` + motor id `0..11`
- [ ] 시나리오: `fresh/used/aged/critical`
- [ ] 커리큘럼: velocity(160~500), DR(501~1000), push(1001~1600), PHM(1601~3000), 이후 final mixture 고정
- [ ] PPO 스케줄: entropy 0.01 -> 0.005 -> 0.003, action std cap-only + late limiter

========================================================================
2. 체크포인트 게이트 (CP0~CP5)
========================================================================
CP0. 실행 준비
- [ ] seed/경로/로그 디렉토리 규칙 고정
- [ ] 평가 명령(`evaluate.py`)에서 strict 모드 확인

CP1. 3000 도달(커리큘럼 종료 시점)
- [ ] 3000은 "수렴 시작점"으로만 기록(최종판정 금지)
- [ ] final mixture 고정 전환 확인

CP2. 4000 도달(고정 분포 적응 1차 확인)
- [ ] 최근 200iter에서 `time_out` 하락 추세가 멈췄는지 확인
- [ ] 최근 200iter에서 `bad_orientation` 상승 추세가 멈췄는지 확인

CP3. 5000 도달(논문 최소선)
- [ ] 12모터 스윕으로 평균 + worst-case 성능 집계
- [ ] best checkpoint 선택(Score 최대)

CP4. 5000+ 연장 여부
- [ ] Score 개선이 남아있으면 6000~7000 연장
- [ ] 개선이 없으면 early-stop 후 종료

CP5. 논문 산출물 확정
- [ ] seed 3개 통계표
- [ ] 12모터 heatmap
- [ ] fresh/used/aged/critical 영상 + TB 그림

========================================================================
3. 평가/점수/조기중단 규칙
========================================================================
평가 루프:
- [ ] `eval_interval = 100 iter`
- [ ] 매 평가마다 motor id 0..11 고정 스윕
- [ ] 저장 지표: `time_out`, `bad_orientation`, `base_contact`, `tracking error`

권장 점수(robust score):
- TO_mean = mean_i(time_out_i)
- TO_min  = min_i(time_out_i)
- BO_mean = mean_i(bad_orientation_i)
- Score   = 0.6*TO_min + 0.4*TO_mean - 0.8*BO_mean

조기중단:
- [ ] window `W = 10` (최근 평가 10개)
- [ ] Plateau stop: 최근 W에서 best 개선 < 0.005 and 기울기 ~ 0
- [ ] Regression stop: TO_min이 best 대비 0.02 이상 하락이 2회 연속

========================================================================
4. 3000+ 이후 허용 조정 (2개만)
========================================================================
- [ ] 액션1: LR 안정화
  - 3000+ 또는 plateau 진입 시 lr 0.5x
  - 필요 시 1회 추가 0.5x
- [ ] 액션2: worst-motor 노출 강화
  - 60~70%: uniform random motor
  - 30~40%: recent worst top-k motor

주의:
- [ ] entropy/std/rollout을 동시에 여러 개 바꾸지 않는다.

========================================================================
5. 논문용 실행 세트
========================================================================
학습(RealObs):
- [ ] seed 42/43/44, max_iterations >= 5000 (권장 상한 7000~8000 + early-stop)

학습(Baseline):
- [ ] seed 42/43/44, 동일 iteration 예산

평가(고정 12모터):
- [ ] `evaluate.py --eval_fault_mode single_motor_fixed --eval_fault_motor_id <0..11>`
- [ ] paper strict 기본 유지
- [ ] exploratory 실험만 `--no-paper_protocol_strict` 허용

========================================================================
6. 논문 방어 체크리스트
========================================================================
- [ ] x축은 iterations보다 transitions/steps 중심으로 표기
- [ ] plateau 구간(수렴 구간) 명시
- [ ] 동일 예산 비교군 유지
- [ ] wall-clock/GPU/num_envs 공개
- [ ] 평균 + worst-case(TO_min) 동시 보고

========================================================================
7. 이번 주 액션 TODO
========================================================================
- [ ] (1) 5000+ 장기 run 2개(RealObs/Baseline) 시작
- [ ] (2) eval sweep 자동 루프(100 iter) 실행
- [ ] (3) best checkpoint + early-stop 로그 확정
- [ ] (4) 12모터 heatmap/표 자동 생성
- [ ] (5) 노션 업로드(TB/영상/의사결정 이유 포함) 완료

끝.
